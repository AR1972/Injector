#ifndef MAIN_H
#define MAIN_H
//
/* This program is free software. It comes without any warranty, to
* the extent permitted by applicable law. You can redistribute it
* and/or modify it under the terms of the Do What The Fuck You Want
* To Public License, Version 2, as published by Sam Hocevar. See
* http://sam.zoy.org/wtfpl/COPYING for more details. */
//
#include <Protocol\AcpiSupport.h>
#include <Protocol\LegacyBios.h>
#include <Protocol\SimpleFileSystem.h>
#include <Protocol\LoadedImage.h>
#include <Protocol\LegacyRegion.h>
#include <Guid\EventGroup.h>
#include <Guid\Acpi.h>
#include <Guid\FileInfo.h>
//
// {9CEB005D-273B-4231-A670-F3C86CCFA9AF}
#define OA_MARKER { 0x9ceb005d, 0x273b, 0x4231, 0xa6, 0x70, 0xf3, 0xc8, 0x6c, 0xcf, 0xa9, 0xaf }
// {F12D1538-809F-44B6-870D-6FEA5DA5D6F3}
#define OA_PUBLIC_KEY { 0xf12d1538, 0x809f, 0x44b6, 0x87, 0xd, 0x6f, 0xea, 0x5d, 0xa5, 0xd6, 0xf3 }
// {4002F4A3-4302-431C-B1B7-6510B37126E1} 
#define OA_SLP10 { 0x4002f4a3, 0x4302, 0x431c, 0xb1, 0xb7, 0x65, 0x10, 0xb3, 0x71, 0x26, 0xe1 }
//
// Gloabals
//
EFI_GUID AcpiProtocolGuid = EFI_ACPI_SUPPORT_GUID;
EFI_GUID EfiAcpiTableGuid = ACPI_10_TABLE_GUID;
EFI_GUID EfiAcpi20TableGuid = EFI_ACPI_20_TABLE_GUID;
EFI_GUID OaMarkerGuid = OA_MARKER;
EFI_GUID OaPublicKeyGuid = OA_PUBLIC_KEY;
EFI_GUID OaSlpGuid = OA_SLP10;
EFI_GUID LegacyRegionGuid = EFI_LEGACY_REGION_PROTOCOL_GUID;
EFI_GUID LegacyBiosGuid = EFI_LEGACY_BIOS_PROTOCOL_GUID;
EFI_GUID gLoadedImageProtocol = LOADED_IMAGE_PROTOCOL;
EFI_GUID gDevicePathProtocol = DEVICE_PATH_PROTOCOL;
EFI_GUID gFileSystemProtocol = SIMPLE_FILE_SYSTEM_PROTOCOL;
EFI_GUID gFileInfo = EFI_FILE_INFO_ID;
CHAR16* OaMarkerName = L"OaMarker";
CHAR16* OaPublicKeyName = L"OaPublicKey";
CHAR16* OaSlpName = L"OaSlp";
EFI_EVENT EventReadyToBoot;
//
unsigned char SLIC[]=
{
	0x53,0x4C,0x49,0x43,0x76,0x01,0x00,0x00,0x01,0x00,0x41,
	0x20,0x4D,0x20,0x49,0x20,0x4F,0x45,0x4D,0x53,0x4C,0x49,
	0x43,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x9C,0x00,0x00,0x00,
	0x06,0x02,0x00,0x00,0x00,0x24,0x00,0x00,0x31,0x41,0x53,
	0x52,0x00,0x04,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xB6,0x00,
	0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x57,0x49,
	0x4E,0x44,0x4F,0x57,0x53,0x20,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
//
#pragma pack(1)
typedef struct {        
    UINT32		Signature;			/* unique signature */
    UINT32		Length;				/* length of the table */
    UINT8		Revision;			/* current rev is 1 */
    UINT8		Checksum;			/* entire table must sum zero */
    UINT8		OemId[6];			/* string that identifies OEM */
    UINT8		OemTableId[8];		/* manufacturer model ID */
    UINT32		OemRevision;		/* OEM revsion of this table */
    UINT8		CreatorId[4];		/* string that identifies creator */
    UINT32		CreatorRevision;	/* creator rev of this table */
} AcpiHeader_t;
//
// RSDT
//
typedef struct {
	AcpiHeader_t Header;	/* header */
	UINT32 Entry[1];		/* array of physical address that point to other description */
} RsdtTbl_t;
//
// XSDT
//
typedef struct {
	AcpiHeader_t Header;	/* header */
	UINT64 Entry[1];		/* array of physical address that point to other description */
} XsdtTbl_t;
//
typedef struct {
	AcpiHeader_t Header;
	UINT8 Data[1];
} AcpiTbl_t;
//
// RST_PTR
//
typedef struct {
	UINT64		Signature;			/* "RSD PTR " */
    UINT8       Checksum;			/* entire table must sum zero */
    UINT8       OemId[6];			/* string that identifies OEM */
    UINT8       Revision;
    UINT32      RSDTAddress;		/* physical address of the RSDT table */
    UINT32      Length;
    UINT64      XSDTAddress;		/* physical address of the XSDT table */
    UINT8       ExtendedChecksum;
    UINT8       Reserved[3];
} Rsdp20Tbl_t;
//
// SLIC
//
typedef struct {
	UINT32 Ukn0;
	UINT32 Length;
	UINT32 Ukn1;
	UINT8 OemId[6];
	UINT8 OemTableId[8];
	UINT8 CreatorId[8];
	UINT32 Version;
	UINT64 Ukn2;
	UINT64 Ukn3;
	UINT8 Data[128];
} Marker_t;
//
typedef struct {
	UINT32 Ukn0;
	UINT32 Length;
	UINT32 Ukn1;
	UINT32 Ukn2;
	UINT8 Type[4];
	UINT32 Ukn4;
	UINT32 Ukn5;
	UINT8 Data[128];
} PublicKey_t;
//
typedef struct {
	AcpiHeader_t Header;
	PublicKey_t PublicKey;
	Marker_t Marker;
} SlicTbl_t;
#pragma pack()
#endif